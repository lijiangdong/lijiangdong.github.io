<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Android的IPC机制（一）—AIDL的使用 &#8211; 李江东</title>
<meta name="description" content="Describe your website here.">
<meta name="keywords" content="ipc">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@lijiangdong">
<meta name="twitter:creator" content="@lijiangdong">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Android的IPC机制（一）—AIDL的使用">
<meta property="og:description" content="Describe your website here.">
<meta property="og:url" content="http://www.lijiangdong.com/android/ipc1-aidl/">
<meta property="og:site_name" content="李江东">
<meta property="og:image" content="http://www.lijiangdong.com/images/images/logo.png">





<link rel="canonical" href="http://www.lijiangdong.com/android/ipc1-aidl/">
<link href="http://www.lijiangdong.com/feed.xml" type="application/atom+xml" rel="alternate" title="李江东 Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

<!-- For all browsers -->
<link rel="stylesheet" href="http://www.lijiangdong.com/assets/css/main.css">
<link rel="stylesheet" href="http://www.lijiangdong.com/assets/css/jquery.mmenu.all.css">
<link rel="stylesheet" href="http://www.lijiangdong.com/assets/css/jquery.floating-social-share.min.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script type="text/javascript" src="http://www.lijiangdong.com/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://www.lijiangdong.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://www.lijiangdong.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://www.lijiangdong.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://www.lijiangdong.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://www.lijiangdong.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://www.lijiangdong.com/images/apple-touch-icon-144x144-precomposed.png">




</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->



<div class="header-menu header-menu-top">
    <ul class="header-item-container">
      <li class="header-item-title header-toggle "><a href="#menu"><h2><i class="fa fa-bars"></i></h2></a></li>
      <li class="header-item-title">
        <a href="http://www.lijiangdong.com/">
          
            <img class="logo" src="http://www.lijiangdong.com/images/logo.png" alt="李江东">
          
          <a href="http://www.lijiangdong.com/" class="title"> 李江东</a>
        </a>
      </li>
      
        
        

        
            
                <li class="header-item "><a href="http://www.lijiangdong.com/about"><h3>About</h3></a></li>
            
        
      
        
        

        
          <li class="header-item "><a href="http://www.lijiangdong.com/categories"><h3>Categories</h3></a>
            <ul class="header-submenu">
              
                
                  <li class="sub-item"><a href="/categories/#Android">Android</a></li>
              
            </ul>
          </li>
        
      
        
        

        
            
                <li class="header-item "><a href="http://www.lijiangdong.com/tags"><h3>Tags</h3></a></li>
            
        
      
        
        

        
            
                <li class="header-item "><a href="https://github.com/lijiangdong" target="_blank"><h3>GitHub</h3></a></li>
            
        
      
        
        

        
            
                <li class="header-item "><a href="http://www.lijiangdong.com/blog"><h3>Blog</h3></a></li>
            
        
      
        
        

        
            
                <li class="header-item "><a href="http://www.lijiangdong.com/"><h3>Home</h3></a></li>
            
        
      
      <li class="header-item"><a href="http://www.lijiangdong.com/search"><h3><i class="fa fa-search"></i></h3></a></li>
    </ul>
  </div>
<div class="entry-header">
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Android的IPC机制（一）—AIDL的使用</h1>
      
        <h2><span class="entry-date date published updated"><time datetime="2016-02-20T00:00:00+08:00">February 20, 2016</time></span></h2>
      

      
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~10 minutes
        </p><!-- /.entry-reading-time -->
      
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->


<nav id="menu" style="display: none">
  <ul>
    
      
        <li><a href="http://www.lijiangdong.com/"><h3>Home</h3></a></li>
      
    
      
        <li><a href="http://www.lijiangdong.com/blog"><h3>Blog</h3></a></li>
      
    
      
        <li><a href="http://www.lijiangdong.comhttps://github.com/lijiangdong"><h3>GitHub</h3></a></li>
      
    
      
        <li><a href="http://www.lijiangdong.com/tags"><h3>Tags</h3></a></li>
      
    
      
        <li><a href="http://www.lijiangdong.com/categories"><h3>Categories</h3></a>
          <ul>
            
              
                <li><a href="http://www.lijiangdong.com/categories/#Android">Android</a></li>
            
          </ul>
        </li>
      
    
      
        <li><a href="http://www.lijiangdong.com/about"><h3>About</h3></a></li>
      
    
  </ul>
</nav>


  <a href="https://twitter.com/lijiangdong" class="btn btn-info button-twitter" data-show-count="false" data-size="large"><i class="fa fa-twitter"></i> <span> | Follow @lijiangdong</span></a>



<div id="main" role="main">
  <article class="hentry">
    <div class="entry-content">
        
      <h1 class="post-title entry-title">Android的IPC机制（一）—AIDL的使用</h1>
      <p>　　IPC(interprocess communication)是指进程间通信，也就是在两个进程间进行数据交互。不同的操作系统都有他们自己的一套IPC机制。例如在Linux操作系统中可以通过管道、信号量、消息队列、内存共享、套接字等进行进程间通信。那么在Android系统中我们可以通过Binder来进行进程间的通信。当然除了Binder我们还可以使用Socket来进行进程间的通信。more</p>

<p>　　既然需要进程通信，那么就必须有多个进程。当然，在两个应用交互中必然出现多进程的情况。若是在一个应用中呢？我们可以通过给四大组件在AndroidMenifest中为他们指定android:process属性来实现不同的组件在不同进程中运行。下面就来介绍一下Android中进程间通信的实现方式。</p>

<h2>AIDL简介</h2>

<p>　　AIDL是 Android Interface Definition Language的缩写。AIDL 是一种IDL 语言，用于生成可以在Android设备上两个进程之间进行 IPC的代码。如果在一个进程中（例如Activity）要调用另一个进程中（例如Service）对象的操作，就可以使用AIDL生成可序列化的参数。</p>

<p>　　AIDL机制是面向接口的，像COM或Corba一样，但是更加轻量级。它是使用代理类在客户端和实现端传递数据。</p>

<h2>AIDL用法</h2>

<p>　　首先我们创建一个AIDL文件，在AndroidStudio中当我们创建一个AIDL文件时会自动为我们创件一个AILD文件夹,用于存放AIDL文件。创建完之后重新rebuild会自动生成aidl实现类。</p>

<p>　　<img src="http://img.blog.csdn.net/20160220165323807" alt="这里写图片描述" /></p>

<p>　　在下面的例子当中，我们将Service单独作为一个应用在系统中运行，在另一个用于访问Service的client也单独作为一个应用运行在系统中。这样保证了两个程序分别运行在两个进程中。并且使用了<a href="https://github.com/JakeWharton/butterknife">butterknife</a>进行控件绑定。</p>

<h3>AIDL简单用法</h3>

<p><strong>演示</strong></p>

<p>　　在Service中我们对客户端传来的两个整数做了一次加法运算并返回到客户端中。</p>

<p><img src="http://img.blog.csdn.net/20160220151918200" alt="这里写图片描述" /></p>

<p><strong>AIDL代码</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="c1">// ICalculate.aidl</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ljd</span><span class="o">.</span><span class="na">aidl</span><span class="o">;</span>

<span class="c1">// Declare any non-default types here with import statements</span>

<span class="kd">interface</span> <span class="nc">ICalculate</span> <span class="o">{</span>
    <span class="cm">/**
     * Demonstrates some basic types that you can use as parameters
     * and return values in AIDL.
     */</span>
    <span class="kt">int</span> <span class="n">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">first</span><span class="o">,</span> <span class="kt">int</span> <span class="n">second</span><span class="o">);</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><strong>服务端代码</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ljd</span><span class="o">.</span><span class="na">aidl</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Binder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.RemoteException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ljd.aidl.ICalculate</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalculateService</span> <span class="kd">extends</span> <span class="n">Service</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">CalculateService</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Binder</span> <span class="n">mBinder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ICalculate</span><span class="o">.</span><span class="na">Stub</span><span class="o">(){</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">first</span><span class="o">,</span> <span class="kt">int</span> <span class="n">second</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">RemoteException</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">IBinder</span> <span class="n">onBind</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mBinder</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><strong>客户端代码</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre></td><td class="code"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ljd</span><span class="o">.</span><span class="na">aidl</span><span class="o">.</span><span class="na">activity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.content.ComponentName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.ServiceConnection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.RemoteException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Toast</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ljd.aidl.ICalculate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ljd.aidl.client.R</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">butterknife.ButterKnife</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">butterknife.OnClick</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Demo1Activity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">"DEMO1"</span><span class="o">;</span>
    <span class="c1">//是否已经绑定service</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">mIsBindService</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">ICalculate</span> <span class="n">mCalculate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">ServiceConnection</span> <span class="n">mConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServiceConnection</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onServiceConnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">,</span> <span class="n">IBinder</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span><span class="s">"bind success"</span><span class="o">);</span>
            <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">Demo1Activity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span><span class="s">"bind service success"</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
            <span class="n">mCalculate</span> <span class="o">=</span> <span class="n">ICalculate</span><span class="o">.</span><span class="na">Stub</span><span class="o">.</span><span class="na">asInterface</span><span class="o">(</span><span class="n">service</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onServiceDisconnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//重新绑定Service防止系统将服务进程杀死而产生的调用错误。</span>
            <span class="n">bindService</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_demo1</span><span class="o">);</span>
        <span class="n">ButterKnife</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">mIsBindService</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">unbindService</span><span class="o">();</span>
        <span class="n">ButterKnife</span><span class="o">.</span><span class="na">unbind</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@OnClick</span><span class="o">({</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">bind_demo1_btn</span><span class="o">,</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">unbind_demo1_btn</span><span class="o">,</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">calculate_btn</span><span class="o">})</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onClickButton</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">()){</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">bind_demo1_btn</span><span class="o">:</span>
                <span class="n">bindService</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">unbind_demo1_btn</span><span class="o">:</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="s">"unbind service success"</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="n">unbindService</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">calculate_btn</span><span class="o">:</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">mIsBindService</span> <span class="o">&amp;&amp;</span> <span class="n">mCalculate</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">){</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">mCalculate</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">);</span>
                        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">result</span><span class="o">));</span>
                        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">result</span><span class="o">),</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RemoteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="s">"not bind service"</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="n">bindService</span><span class="o">(){</span>
        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">"com.ljd.aidl.action.CALCULATE_SERVICE"</span><span class="o">);</span>
        <span class="n">bindService</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span><span class="n">mConnection</span><span class="o">,</span> <span class="n">Context</span><span class="o">.</span><span class="na">BIND_AUTO_CREATE</span><span class="o">);</span>
        <span class="n">mIsBindService</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="n">unbindService</span><span class="o">(){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">mIsBindService</span><span class="o">){</span>
            <span class="n">mIsBindService</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="n">unbindService</span><span class="o">(</span><span class="n">mConnection</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3>AIDL高级用法</h3>

<p>　　对于上面的例子，在AIDL接口中只是使用了一些Java的基本类型，对于AIDL文件并不是所有的类型都是可用的，那么在AIDL中究竟有哪些类型可以使用呢？</p>

<p><strong>AIDL语法规则</strong></p>

<p>默认情况下AIDL支持以下数据类型：</p>

<ul>
  <li>所有Java的基本数据类型（例如： int, long,double, char, boolean等）</li>
  <li>String和CharSequence</li>
  <li>List：AIDL实际接收到的是ArrayList，并且List里面所有元素都必须被AIDL支持</li>
  <li>Map: AIDL实际接收到的是HashMap，并且Map里面所有元素都必须被AIDL支持</li>
</ul>

<p>如果不是上面所述类型，我们必须要显示import进来，即使他们在同一个包中。当我们使用自定义的对象时必须实现Parcelable接口，Parcelable为对象序列化接口，效率比实现Serializable接口高。并且新建一个与该类同名的AIDL文件，声明他为Parcelable类型。</p>

<p>我们定义AIDL接口还需要注意以下几点：</p>

<ul>
  <li>方法可以有多个或没有参数，可以有返回值也可以为void</li>
  <li>在参数中，除了基本类型以外，我们必须为参数标上方向in, out, 或者 inout</li>
  <li>在AIDL文件中只支持方法，不支持静态常量</li>
</ul>

<p><strong>演示</strong></p>

<p>　　在计算机商店中需要采购笔记本进行销售，在服务端中我们添加两台笔记本，在客户端中我们为商店加购一台dell笔记本。</p>

<p><img src="http://img.blog.csdn.net/20160220151944872" alt="这里写图片描述" /></p>

<p><strong>实体类代码</strong></p>

<p>　　我们首先构建一个计算机实体类，包含笔记本的id，品牌，型号，并且实现Parcelable接口，在AndroidStudio中会为我们自动构造代码。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></td><td class="code"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ljd</span><span class="o">.</span><span class="na">aidl</span><span class="o">.</span><span class="na">entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.os.Parcel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Parcelable</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComputerEntity</span> <span class="kd">implements</span> <span class="n">Parcelable</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="n">computerId</span><span class="o">;</span>     <span class="c1">//id</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">brand</span><span class="o">;</span>       <span class="c1">//品牌</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">model</span><span class="o">;</span>       <span class="c1">//型号</span>

    <span class="kd">public</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="kt">int</span> <span class="n">computerId</span><span class="o">,</span> <span class="n">String</span> <span class="n">brand</span><span class="o">,</span> <span class="n">String</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">brand</span> <span class="o">=</span> <span class="n">brand</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">computerId</span> <span class="o">=</span> <span class="n">computerId</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">in</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">computerId</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span>
        <span class="n">brand</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readString</span><span class="o">();</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Creator</span><span class="o">&lt;</span><span class="n">ComputerEntity</span><span class="o">&gt;</span> <span class="n">CREATOR</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Creator</span><span class="o">&lt;</span><span class="n">ComputerEntity</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">ComputerEntity</span> <span class="n">createFromParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">in</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">ComputerEntity</span><span class="o">[]</span> <span class="n">newArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">ComputerEntity</span><span class="o">[</span><span class="n">size</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">describeContents</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">writeToParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">dest</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">dest</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">computerId</span><span class="o">);</span>
        <span class="n">dest</span><span class="o">.</span><span class="na">writeString</span><span class="o">(</span><span class="n">brand</span><span class="o">);</span>
        <span class="n">dest</span><span class="o">.</span><span class="na">writeString</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><strong>AIDL代码</strong></p>

<p>　　在AIDL中对实体类进行声明，包名和文件名必须与实体类一致。在AndroidStudio中新建一个与实体类同名的AIDL文件会报错，需要先用一个其它名字，然后修改与实体类名一致即可。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ljd</span><span class="o">.</span><span class="na">aidl</span><span class="o">.</span><span class="na">entity</span><span class="o">;</span>

<span class="c1">//包名必须和对用实体类的包名一致</span>
<span class="c1">// Declare any non-default types here with import statements</span>
<span class="n">parcelable</span> <span class="n">ComputerEntity</span><span class="o">;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>　　添加两个接口分别为添加一台笔记本和获取全部笔记本，在该文件中使用到了ComputerEntity类，显示的import进来。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="err">　</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ljd</span><span class="o">.</span><span class="na">aidl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ljd.aidl.entity.ComputerEntity</span><span class="o">;</span>
<span class="c1">// Declare any non-default types here with import statements</span>

<span class="kd">interface</span> <span class="nc">IComputerManager</span> <span class="o">{</span>
    <span class="cm">/**
     * Demonstrates some basic types that you can use as parameters
     * and return values in AIDL.
     */</span>
     <span class="kt">void</span> <span class="n">addComputer</span><span class="o">(</span><span class="n">in</span> <span class="n">ComputerEntity</span> <span class="n">computer</span><span class="o">);</span>
     <span class="n">List</span><span class="o">&lt;</span><span class="n">ComputerEntity</span><span class="o">&gt;</span> <span class="n">getComputerList</span><span class="o">();</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><strong>服务端代码</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></td><td class="code"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ljd</span><span class="o">.</span><span class="na">aidl</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.RemoteException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ljd.aidl.IComputerManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ljd.aidl.entity.ComputerEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.CopyOnWriteArrayList</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComputerService</span> <span class="kd">extends</span> <span class="n">Service</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;</span><span class="n">ComputerEntity</span><span class="o">&gt;</span> <span class="n">mComputerList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="n">ComputerService</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">IComputerManager</span><span class="o">.</span><span class="na">Stub</span> <span class="n">mBinder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IComputerManager</span><span class="o">.</span><span class="na">Stub</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">addComputer</span><span class="o">(</span><span class="n">ComputerEntity</span> <span class="n">computer</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">RemoteException</span> <span class="o">{</span>
            <span class="n">mComputerList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">computer</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ComputerEntity</span><span class="o">&gt;</span> <span class="n">getComputerList</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">RemoteException</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">mComputerList</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
        <span class="n">mComputerList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="s">"apple"</span><span class="o">,</span><span class="s">"macbookpro"</span><span class="o">));</span>
        <span class="n">mComputerList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="s">"microsoft"</span><span class="o">,</span><span class="s">"surfacebook"</span><span class="o">));</span>
        <span class="n">mComputerList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="s">"dell"</span><span class="o">,</span><span class="s">"XPS13"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">IBinder</span> <span class="n">onBind</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mBinder</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>　　注意：在该类中使用了CopyOnWriteArrayList，CopyOnWriteArrayList能够自动进行线程同步。可是在AIDL中接收和返回的只能是ArrayList，其实AIDL支持的是抽象的List，在Binder中会按照List访问数据并最终形成一个ArrayList，所以在AIDL中返回的还是一个ArrayList。</p>

<p><strong>客户端代码</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125</pre></td><td class="code"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ljd</span><span class="o">.</span><span class="na">aidl</span><span class="o">.</span><span class="na">activity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.content.ComponentName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.ServiceConnection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.RemoteException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.LinearLayout</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Toast</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ljd.aidl.IComputerManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ljd.aidl.client.R</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ljd.aidl.entity.ComputerEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">butterknife.Bind</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">butterknife.ButterKnife</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">butterknife.OnClick</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Demo2Activity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span><span class="o">{</span>

    <span class="nd">@Bind</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">show_linear</span><span class="o">)</span>
    <span class="n">LinearLayout</span> <span class="n">mShowLinear</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">mIsBindService</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">IComputerManager</span> <span class="n">mRemoteComputerManager</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">IBinder</span><span class="o">.</span><span class="na">DeathRecipient</span> <span class="n">mDeathRecipient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IBinder</span><span class="o">.</span><span class="na">DeathRecipient</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">binderDied</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">mRemoteComputerManager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
                <span class="n">mRemoteComputerManager</span><span class="o">.</span><span class="na">asBinder</span><span class="o">().</span><span class="na">unlinkToDeath</span><span class="o">(</span><span class="n">mDeathRecipient</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
                <span class="n">mRemoteComputerManager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                <span class="n">bindService</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>
    <span class="kd">private</span> <span class="n">ServiceConnection</span> <span class="n">mConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServiceConnection</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onServiceConnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">,</span> <span class="n">IBinder</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mIsBindService</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">Demo2Activity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span><span class="s">"bind service success"</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
            <span class="n">mRemoteComputerManager</span> <span class="o">=</span> <span class="n">IComputerManager</span><span class="o">.</span><span class="na">Stub</span><span class="o">.</span><span class="na">asInterface</span><span class="o">(</span><span class="n">service</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">mRemoteComputerManager</span><span class="o">.</span><span class="na">asBinder</span><span class="o">().</span><span class="na">linkToDeath</span><span class="o">(</span><span class="n">mDeathRecipient</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RemoteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onServiceDisconnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mRemoteComputerManager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_demo2</span><span class="o">);</span>
        <span class="n">ButterKnife</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">mIsBindService</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">unbindService</span><span class="o">();</span>
        <span class="n">ButterKnife</span><span class="o">.</span><span class="na">unbind</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@OnClick</span><span class="o">({</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">bind_demo2_btn</span><span class="o">,</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">unbind_demo2_btn</span><span class="o">,</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">test_demo2_btn</span><span class="o">,</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">clear_demo2_btn</span><span class="o">})</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onClickButton</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">()){</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">bind_demo2_btn</span><span class="o">:</span>
                <span class="n">bindService</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">unbind_demo2_btn</span><span class="o">:</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="s">"unbind service success"</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="n">unbindService</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">test_demo2_btn</span><span class="o">:</span>
                <span class="k">if</span> <span class="o">(!</span><span class="n">mIsBindService</span> <span class="o">||</span> <span class="n">mRemoteComputerManager</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
                    <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="s">"not bind service"</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">List</span><span class="o">&lt;</span><span class="n">ComputerEntity</span><span class="o">&gt;</span> <span class="n">computerList</span> <span class="o">=</span> <span class="n">mRemoteComputerManager</span><span class="o">.</span><span class="na">getComputerList</span><span class="o">();</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">computerList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"computerId:"</span> <span class="o">+</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">computerList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">computerId</span><span class="o">)</span> <span class="o">+</span>
                                <span class="s">" brand:"</span> <span class="o">+</span> <span class="n">computerList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">brand</span> <span class="o">+</span>
                                <span class="s">" model:"</span> <span class="o">+</span> <span class="n">computerList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">model</span> <span class="o">;</span>
                        <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
                        <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                        <span class="n">mShowLinear</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">textView</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RemoteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">clear_demo2_btn</span><span class="o">:</span>
                <span class="n">mShowLinear</span><span class="o">.</span><span class="na">removeAllViews</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="n">bindService</span><span class="o">(){</span>
        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">"com.ljd.aidl.action.COMPUTER_SERVICE"</span><span class="o">);</span>
        <span class="n">mIsBindService</span> <span class="o">=</span> <span class="n">bindService</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span><span class="n">mConnection</span><span class="o">,</span> <span class="n">Context</span><span class="o">.</span><span class="na">BIND_AUTO_CREATE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="n">unbindService</span><span class="o">(){</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">mIsBindService</span><span class="o">){</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">mIsBindService</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">unbindService</span><span class="o">(</span><span class="n">mConnection</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>　　由于Binder是有可能会意外死亡的，也就是Service所在进程被系统杀死，这时候我们调用Service的方法就会失败。在第一个例子中我们通过onServiceDisconnected方法中重新绑定服务。在这个例子中我们采用了另外一种方法，由于在Binder中提供了两个配对的方法linkToDeath和unlinkToDeath，通过linkToDeath可以给Binder设置一个死亡代理，Binder死亡时回调binderDied方法，在binderDied方法中我们重新绑定服务即可。</p>

<h3>AIDL用法拓展</h3>

<p>　　当我们需要一种笔记本的时候，由于商店缺货，这时候我们会给卖家说一声，我所需要的这款笔记本到货后通知我。也就成了所谓的观察者模式。
　　在Android系统中为我们提供了一个RemoteCallbackList,RemoteCallbackList是系统专门用来删除跨进程的listener接口，并且在RemoteCallbackList中自动实现了线程同步功能，下面看一下它的用法。</p>

<p><strong>演示</strong></p>

<p>　　客户端注册服务以后，服务端每隔三秒会添加一台笔记本，并通知给客户端显示。</p>

<p><img src="http://img.blog.csdn.net/20160220152001794" alt="这里写图片描述" /></p>

<p><strong>AIDL代码</strong></p>

<p>　　到货后的AIDL监听接口</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ljd</span><span class="o">.</span><span class="na">aidl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ljd.aidl.entity.ComputerEntity</span><span class="o">;</span>
<span class="c1">// Declare any non-default types here with import statements</span>

<span class="kd">interface</span> <span class="nc">IOnComputerArrivedListener</span> <span class="o">{</span>
    <span class="cm">/**
     * Demonstrates some basic types that you can use as parameters
     * and return values in AIDL.
     */</span>
    <span class="kt">void</span> <span class="n">onComputerArrived</span><span class="o">(</span><span class="n">in</span> <span class="n">ComputerEntity</span> <span class="n">computer</span><span class="o">);</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>　　在IComputerManager接口中添加两个方法。显示importIOnComputerArrivedListener ,即使在同一个包下面。
　　</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="c1">// IComputerManagerObserver.aidl</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ljd</span><span class="o">.</span><span class="na">aidl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ljd.aidl.entity.ComputerEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ljd.aidl.IOnComputerArrivedListener</span><span class="o">;</span>
<span class="c1">// Declare any non-default types here with import statements</span>

<span class="kd">interface</span> <span class="nc">IComputerManagerObserver</span> <span class="o">{</span>
    <span class="cm">/**
     * Demonstrates some basic types that you can use as parameters
     * and return values in AIDL.
     */</span>
     <span class="kt">void</span> <span class="n">addComputer</span><span class="o">(</span><span class="n">in</span> <span class="n">ComputerEntity</span> <span class="n">computer</span><span class="o">);</span>
     <span class="n">List</span><span class="o">&lt;</span><span class="n">ComputerEntity</span><span class="o">&gt;</span> <span class="n">getComputerList</span><span class="o">();</span>
     <span class="kt">void</span> <span class="n">registerUser</span><span class="o">(</span><span class="n">IOnComputerArrivedListener</span> <span class="n">listener</span><span class="o">);</span>
     <span class="kt">void</span> <span class="n">unRegisterUser</span><span class="o">(</span><span class="n">IOnComputerArrivedListener</span> <span class="n">listener</span><span class="o">);</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><strong>服务端代码</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">android.app.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Binder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.RemoteCallbackList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.RemoteException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ljd.aidl.IComputerManagerObserver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ljd.aidl.IOnComputerArrivedListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ljd.aidl.entity.ComputerEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.CopyOnWriteArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.atomic.AtomicBoolean</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComputerObserverService</span> <span class="kd">extends</span> <span class="n">Service</span><span class="o">{</span>
    <span class="kd">public</span> <span class="n">ComputerObserverService</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;</span><span class="n">ComputerEntity</span><span class="o">&gt;</span> <span class="n">mComputerList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="n">RemoteCallbackList</span><span class="o">&lt;</span><span class="n">IOnComputerArrivedListener</span><span class="o">&gt;</span> <span class="n">mComputerArrivedListenerList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RemoteCallbackList</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="n">AtomicBoolean</span> <span class="n">mIsServiceDestroy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicBoolean</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

    <span class="kd">private</span> <span class="n">Binder</span> <span class="n">mBinder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IComputerManagerObserver</span><span class="o">.</span><span class="na">Stub</span><span class="o">(){</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">addComputer</span><span class="o">(</span><span class="n">ComputerEntity</span> <span class="n">computer</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">RemoteException</span> <span class="o">{</span>
            <span class="n">mComputerList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">computer</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ComputerEntity</span><span class="o">&gt;</span> <span class="n">getComputerList</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">RemoteException</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">mComputerList</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">registerUser</span><span class="o">(</span><span class="n">IOnComputerArrivedListener</span> <span class="n">listener</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">RemoteException</span> <span class="o">{</span>
            <span class="n">mComputerArrivedListenerList</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">unRegisterUser</span><span class="o">(</span><span class="n">IOnComputerArrivedListener</span> <span class="n">listener</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">RemoteException</span> <span class="o">{</span>
            <span class="n">mComputerArrivedListenerList</span><span class="o">.</span><span class="na">unregister</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
        <span class="n">mComputerList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="s">"apple"</span><span class="o">,</span><span class="s">"macbookpro"</span><span class="o">));</span>
        <span class="n">mComputerList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="s">"microsoft"</span><span class="o">,</span><span class="s">"surfacebook"</span><span class="o">));</span>
        <span class="n">mComputerList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="s">"dell"</span><span class="o">,</span><span class="s">"XPS13"</span><span class="o">));</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(!</span><span class="n">mIsServiceDestroy</span><span class="o">.</span><span class="na">get</span><span class="o">()){</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
                        <span class="n">ComputerEntity</span> <span class="n">computer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="n">mComputerList</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span><span class="s">"******"</span><span class="o">,</span><span class="s">"******"</span><span class="o">);</span>
                        <span class="n">mComputerList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">computer</span><span class="o">);</span>
                        <span class="kd">final</span> <span class="kt">int</span> <span class="n">COUNT</span> <span class="o">=</span> <span class="n">mComputerArrivedListenerList</span><span class="o">.</span><span class="na">beginBroadcast</span><span class="o">();</span>
                        <span class="c1">//通知所有注册过的用户</span>
                        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">COUNT</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                            <span class="n">IOnComputerArrivedListener</span> <span class="n">listener</span> <span class="o">=</span> <span class="n">mComputerArrivedListenerList</span><span class="o">.</span><span class="na">getBroadcastItem</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">listener</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
                                <span class="n">listener</span><span class="o">.</span><span class="na">onComputerArrived</span><span class="o">(</span><span class="n">computer</span><span class="o">);</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                        <span class="n">mComputerArrivedListenerList</span><span class="o">.</span><span class="na">finishBroadcast</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RemoteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">IBinder</span> <span class="n">onBind</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mBinder</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
        <span class="n">mIsServiceDestroy</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>　　注意：RemoteCallbackList并不是一个List，所以我们不能像操作List一样操作RemoteCallbackList。并且遍历RemoteCallbackList时，beginBroadcast和finishBroadcast是配对使用的。
<strong>客户端代码</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">android.content.ComponentName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.ServiceConnection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Handler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Message</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.RemoteException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.LinearLayout</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Toast</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ljd.aidl.IComputerManagerObserver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ljd.aidl.IOnComputerArrivedListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ljd.aidl.client.R</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ljd.aidl.entity.ComputerEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">butterknife.Bind</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">butterknife.ButterKnife</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">butterknife.OnClick</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Demo3Activity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="nd">@Bind</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">show_demo3_linear</span><span class="o">)</span>
    <span class="n">LinearLayout</span> <span class="n">mShowLinear</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">mIsBindService</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MESSAGE_COMPUTER_ARRIVED</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">IComputerManagerObserver</span> <span class="n">mRemoteComputerManager</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Handler</span> <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">handleMessage</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">switch</span> <span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">what</span><span class="o">){</span>
                <span class="k">case</span> <span class="nl">MESSAGE_COMPUTER_ARRIVED:</span>
                    <span class="n">ComputerEntity</span> <span class="n">computer</span> <span class="o">=</span> <span class="o">(</span><span class="n">ComputerEntity</span><span class="o">)</span><span class="n">msg</span><span class="o">.</span><span class="na">obj</span><span class="o">;</span>
                    <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"computerId:"</span> <span class="o">+</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">computer</span><span class="o">.</span><span class="na">computerId</span><span class="o">)</span> <span class="o">+</span>
                            <span class="s">" brand:"</span> <span class="o">+</span> <span class="n">computer</span><span class="o">.</span><span class="na">brand</span> <span class="o">+</span>
                            <span class="s">" model:"</span> <span class="o">+</span> <span class="n">computer</span><span class="o">.</span><span class="na">model</span> <span class="o">;</span>
                    <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextView</span><span class="o">(</span><span class="n">Demo3Activity</span><span class="o">.</span><span class="na">this</span><span class="o">);</span>
                    <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                    <span class="n">mShowLinear</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">textView</span><span class="o">);</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="k">default</span><span class="o">:</span>
                    <span class="kd">super</span><span class="o">.</span><span class="na">handleMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
                    <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>

        <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">private</span> <span class="n">IBinder</span><span class="o">.</span><span class="na">DeathRecipient</span> <span class="n">mDeathRecipient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IBinder</span><span class="o">.</span><span class="na">DeathRecipient</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">binderDied</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">mRemoteComputerManager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
                <span class="n">mRemoteComputerManager</span><span class="o">.</span><span class="na">asBinder</span><span class="o">().</span><span class="na">unlinkToDeath</span><span class="o">(</span><span class="n">mDeathRecipient</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
                <span class="n">mRemoteComputerManager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                <span class="n">bindService</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">private</span> <span class="n">ServiceConnection</span> <span class="n">mConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServiceConnection</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onServiceConnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">,</span> <span class="n">IBinder</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mIsBindService</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">Demo3Activity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span><span class="s">"bind service success"</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
            <span class="n">mRemoteComputerManager</span> <span class="o">=</span> <span class="n">IComputerManagerObserver</span><span class="o">.</span><span class="na">Stub</span><span class="o">.</span><span class="na">asInterface</span><span class="o">(</span><span class="n">service</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">mRemoteComputerManager</span><span class="o">.</span><span class="na">asBinder</span><span class="o">().</span><span class="na">linkToDeath</span><span class="o">(</span><span class="n">mDeathRecipient</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RemoteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onServiceDisconnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mRemoteComputerManager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">private</span> <span class="n">IOnComputerArrivedListener</span> <span class="n">mOnComputerArrivedListener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IOnComputerArrivedListener</span><span class="o">.</span><span class="na">Stub</span><span class="o">(){</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="n">onComputerArrived</span><span class="o">(</span><span class="n">ComputerEntity</span> <span class="n">computer</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">RemoteException</span> <span class="o">{</span>
            <span class="n">mHandler</span><span class="o">.</span><span class="na">obtainMessage</span><span class="o">(</span><span class="n">MESSAGE_COMPUTER_ARRIVED</span><span class="o">,</span><span class="n">computer</span><span class="o">).</span><span class="na">sendToTarget</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_demo3</span><span class="o">);</span>
        <span class="n">ButterKnife</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">mIsBindService</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">unbindService</span><span class="o">();</span>
        <span class="n">ButterKnife</span><span class="o">.</span><span class="na">unbind</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@OnClick</span><span class="o">({</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">bind_demo3_btn</span><span class="o">,</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">unbind_demo3_btn</span><span class="o">,</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">test_demo3_btn</span><span class="o">,</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">clear_demo3_btn</span><span class="o">})</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onClickButton</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">()){</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">bind_demo3_btn</span><span class="o">:</span>
                <span class="n">bindService</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">unbind_demo3_btn</span><span class="o">:</span>
                <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="s">"unbind service success"</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="n">unbindService</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">test_demo3_btn</span><span class="o">:</span>
                <span class="k">if</span> <span class="o">(!</span><span class="n">mIsBindService</span> <span class="o">||</span> <span class="n">mRemoteComputerManager</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
                    <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="s">"not bind service"</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>

                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">ComputerEntity</span> <span class="n">computer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComputerEntity</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="s">"hp"</span><span class="o">,</span><span class="s">"envy13"</span><span class="o">);</span>
                    <span class="n">mRemoteComputerManager</span><span class="o">.</span><span class="na">addComputer</span><span class="o">(</span><span class="n">computer</span><span class="o">);</span>
                    <span class="n">List</span><span class="o">&lt;</span><span class="n">ComputerEntity</span><span class="o">&gt;</span> <span class="n">computerList</span> <span class="o">=</span> <span class="n">mRemoteComputerManager</span><span class="o">.</span><span class="na">getComputerList</span><span class="o">();</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">computerList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
                        <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"computerId:"</span> <span class="o">+</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">computerList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">computerId</span><span class="o">)</span> <span class="o">+</span>
                                <span class="s">" brand:"</span> <span class="o">+</span> <span class="n">computerList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">brand</span> <span class="o">+</span>
                                <span class="s">" model:"</span> <span class="o">+</span> <span class="n">computerList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">model</span> <span class="o">;</span>
                        <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
                        <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                        <span class="n">mShowLinear</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">textView</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="n">mRemoteComputerManager</span><span class="o">.</span><span class="na">registerUser</span><span class="o">(</span><span class="n">mOnComputerArrivedListener</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RemoteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">clear_demo3_btn</span><span class="o">:</span>
                <span class="n">mShowLinear</span><span class="o">.</span><span class="na">removeAllViews</span><span class="o">();</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="n">bindService</span><span class="o">(){</span>
        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">"com.ljd.aidl.action.COMPUTER_OBSERVER_SERVICE"</span><span class="o">);</span>
        <span class="n">mIsBindService</span> <span class="o">=</span> <span class="n">bindService</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span><span class="n">mConnection</span><span class="o">,</span> <span class="n">Context</span><span class="o">.</span><span class="na">BIND_AUTO_CREATE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="n">unbindService</span><span class="o">(){</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">mIsBindService</span><span class="o">){</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mRemoteComputerManager</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">mRemoteComputerManager</span><span class="o">.</span><span class="na">asBinder</span><span class="o">().</span><span class="na">isBinderAlive</span><span class="o">()){</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">mRemoteComputerManager</span><span class="o">.</span><span class="na">unRegisterUser</span><span class="o">(</span><span class="n">mOnComputerArrivedListener</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RemoteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">unbindService</span><span class="o">(</span><span class="n">mConnection</span><span class="o">);</span>
        <span class="n">mIsBindService</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h1><a href="https://github.com/lijiangdong/aidl.git">源码下载</a></h1>


      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://www.lijiangdong.com/tags#ipc" title="Pages tagged ipc" class="tag"><span class="term">ipc</span></a></span>
        <span>Updated on <span class="entry-date date updated"><time datetime="2016年2月20">2016年2月20</time></span></span>
        
        <span class="author vcard"><span class="fn">李江东</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://www.lijiangdong.com/android/ipc1-aidl/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://www.lijiangdong.com/android/ipc1-aidl/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=http://www.lijiangdong.com/android/ipc1-aidl/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->

      </footer>
    </div><!-- /.entry-content -->
    <div class="read-more">
  <div class="read-more-header">
    <a href="http://www.lijiangdong.com" class="read-more-btn">About the Author</a>
  </div><!-- /.read-more-header -->
  <div class="read-more-content author-info">
    <h3>李江东</h3>
    <div class="author-container">
      <img class="author-img" src="http://www.lijiangdong.com/images/avatar.jpg" alt="李江东" />
      <div class="author-bio">用代码书写这个世界。</div>
    </div>
    <div class="author-share">
      <ul class="list-inline social-buttons">
        
          <li><a href="https://github.com/lijiangdong" target="_blank"><i class="fa fa-github fa-fw"></i></a></li>
        
      </ul>
      
        <a aria-label="Follow @lijiangdong on GitHub" data-style="mega" href="https://github.com/lijiangdong" class="github-button">Follow @lijiangdong</a>
      
      <br>
      
        <a href="https://twitter.com/lijiangdong" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @lijiangdong</a>
      
    </div>
  </div>
</div>

    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    
  </article>
</div><!-- /#main -->

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">window.jQuery || document.write('<script type="text/javascript" src="http://www.lijiangdong.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script type="text/javascript" src="http://www.lijiangdong.com/assets/js/scripts.min.js"></script>
<script type="text/javascript" async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
<script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>





    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'ljd'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




<script type="text/javascript">
    sharing();
</script>



<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 李江东. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://github.com/aron-bordin/neo-hpstr-jekyll-theme" rel="nofollow">Neo-HPSTR Theme</a>.</span>

  </footer>
</div><!-- /.footer-wrapper -->

</body>
</html>
